#!/usr/bin/python
'''Date : 1402/01/09
Author : AmirhosseinKhanshabani - @AmirZoyber

First step to attaching the client -> finding networks clients are searching for.
Each client might search for multiple SSIDs.
This script will print the SSID and the MAC address of the client that is searching for it.
usage : python3 ClientProbes.py wlan0 1000
'''
import sys
from scapy.all import *

clientprobes = set()

def packetHandler(pkt):
    if pkt.haslayer(Dot11ProbeReq):
        if (len(pkt.info)>0):
            testcase = pkt.addr2 +"---"+ pkt.info
            if testcase not in clientprobes:
                clientprobes.add(testcase)
                print(f"New Probe Found : {len(clientprobes)}, {pkt.addr2}, {pkt.info}")
                print("\n---------Client Proces Table---------")
                counter = 1
                for probe in clientprobes:
                    [client, ssid] = probe.split("---")
                    print(f"{client} : {ssid}")
                    counter+=1
                print("\n--------------------------------------\n")

    return

sniff(iface=sys.argv[1], count=int(sys.argv[2]), prn = packetHandler)